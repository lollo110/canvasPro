const canva = document.querySelector("canvas");
const context = canva.getContext("2d");

function resizeCanvas() {
  canva.width = window.innerWidth;
  canva.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener('resize', () => {
  resizeCanvas();
  createPatterns();
});

let patterns = [];
const SPEED = 4;
const minSize = 3; // dimensione minima punti
const isMobile = window.innerWidth < 920;
const STITCHES_PER_FRAME = isMobile ? 10 : 50;
const LINE_SCALE = isMobile ? 0.4 : 1;

class Cucito {
  constructor(x, y, size, color) {
    this.x = x;
    this.y = y;
    this.size = size;
    this.color = color;
    this.state = 0;
    this.progress = 0;
  }

  drawSegment(x1, y1, x2, y2, p) {
    const curve = isMobile ? 0 : Math.sin(p * Math.PI);
    const midX = x1 + (x2 - x1) * p + curve * 1.2;
const midY = y1 + (y2 - y1) * p + curve * 1.2;
    const baseWidth = 2.5 * LINE_SCALE;
const waveWidth = 1.2 * LINE_SCALE;

const width = baseWidth + Math.sin(p * Math.PI) * waveWidth;

    // filo ombra
    context.strokeStyle = "rgba(0,0,0,0.25)";
    context.lineWidth = width + 2 * LINE_SCALE;
    context.beginPath();
    context.moveTo(x1 + 1.5, y1 + 1.5);
    context.lineTo(midX + 1.5, midY + 1.5);
    context.stroke();

    // filo principale
    context.strokeStyle = this.color;
    context.lineCap = "round";
    context.lineWidth = width;
    context.beginPath();
    context.moveTo(x1, y1);
    context.lineTo(midX, midY);
    context.stroke();

    return { x: midX, y: midY };
  }

  draw(offsetX = 0, offsetY = 0) {
    let needlePos = null;

    const x = this.x + offsetX;
    const y = this.y + offsetY;

    if (this.state === 1)
      needlePos = this.drawSegment(
        x,
        y,
        x + this.size,
        y + this.size,
        this.progress,
      );

    if (this.state >= 2)
      this.drawSegment(x, y, x + this.size, y + this.size, 1);

    if (this.state === 3)
      needlePos = this.drawSegment(
        x + this.size,
        y,
        x,
        y + this.size,
        this.progress,
      );

    if (this.state >= 4)
      this.drawSegment(x + this.size, y, x, y + this.size, 1);

    return needlePos;
  }

  update() {
    if (this.state === 1 || this.state === 3) {
      this.progress += SPEED;
      if (this.progress >= 1) {
        this.progress = 0;
        this.state++;
      }
    }
  }
}


class PatternStitches {
   constructor(pattern, palette, offsetX, offsetY, size) {
    this.stitches = [];
    this.colorGroups = {};
    this.colorStates = {};
    pattern.forEach((row, y) => {
       row.forEach((cell, x) => {
        if (cell !== 0) {
         const stitch = new Cucito( offsetX + x * size, offsetY + y * size, size, palette[cell] );
          if (!this.colorGroups[stitch.color]) {
             this.colorGroups[stitch.color] = [];
             this.colorStates[stitch.color] = 0;
   }
  this.colorGroups[stitch.color].push(stitch);
 }
 });
 });
 }
  draw() {
     for (const color in this.colorGroups) {
       this.colorGroups[color].forEach(s => s.draw());
       }
       }
        update() {
           for (let i = 0; i < STITCHES_PER_FRAME; i++) {
           for (const color in this.colorGroups) {
             const group = this.colorGroups[color];
              let index = this.colorStates[color];
               const stitch = group[index];
                if (!stitch) continue;
                 if (stitch.state === 0) stitch.state = 1;
                  stitch.update();
                   if (stitch.state === 2) stitch.state = 3;
                    if (stitch.state === 4) { this.colorStates[color]++; 

                    }
                   }
                   }
                   }
                  }

// class PatternStitches {
//   constructor(pattern, palette, offsetX, offsetY, size) {
//     this.rows = {};
//     this.rowIndex = 0;
//     this.maxRow = pattern.length;

//     pattern.forEach((row, y) => {
//       this.rows[y] = [];

//       row.forEach((cell, x) => {
//         if (cell !== 0) {
//           this.rows[y].push(
//             new Cucito(
//               offsetX + x * size,
//               offsetY + y * size,
//               size,
//               palette[cell]
//             )
//           );
//         }
//       });
//     });
//   }

//   draw() {
//   for (const y in this.rows) {
//     this.rows[y].forEach(s => s.draw());
//   }
// }

//   update() {
//   const currentRow = this.rows[this.rowIndex];
//   if (!currentRow) return;

//   let finished = true;

//   for (let i = 0; i < STITCHES_PER_FRAME; i++) {
//     currentRow.forEach(stitch => {
//       if (stitch.state < 4) {
//         finished = false;

//         if (stitch.state === 0) stitch.state = 1;
//         stitch.update();
//         if (stitch.state === 2) stitch.state = 3;
//       }
//     });
//   }

//   // Se tutta la riga Ã¨ completata, passa alla successiva
//   if (finished) {
//     this.rowIndex++;
//   }
// }
// }

const palettes = [
  { 1: "#e79ebd" },
  { 1: "#6888BF", 2: "#3B6F32", 3: "#404C8E", 4: "#A8C9F9", 5: "#FFF4C3", 6: "#95885F", 7: "#E9C500" },
  { 1: "#CE9ADE", 2: "#8470A9", 3: "#949CC8", 4: "#381F53", 5: "#3E7D4B", 6: "#1D401B" },
  { 1: "#A23A57", 2: "#56131D", 3: "#DFA7A6", 4: "#911F39", 5: "#3E7D4B"},
  { 1: "#DEB0AB", 2: "#ED7E73", 3: "#A9403B", 4: "#294D22", 5: "#4B5E3A", 6: "#99BE30"}
];

const lettreV = [
  [0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0],
  [1,1,1,1,1,0,0,1,1,1],
  [0,1,1,1,0,0,0,0,1,0],
  [0,0,1,1,0,0,0,1,0,0],
  [0,0,1,1,0,0,0,1,0,0],
  [0,0,0,1,1,0,1,0,0,0],
  [0,0,0,1,1,0,1,0,0,0],
  [0,0,0,0,1,1,0,0,0,0],
  [0,0,0,0,1,1,0,0,0,0],
  [0,0,0,0,0,1,0,0,0,0]
];

const lettreU = [
  [0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0],
  [1,1,1,1,0,0,1,1,1,1,0],
  [0,0,1,1,0,0,0,0,1,1,0],
  [0,0,1,1,0,0,0,0,1,1,0],
  [0,0,1,1,0,0,0,0,1,1,0],
  [0,0,1,1,0,0,0,0,1,1,0],
  [0,0,1,1,0,0,0,0,1,1,0],
  [0,0,1,1,0,0,0,0,1,1,0],
  [0,0,1,1,0,0,0,1,1,1,0],
  [0,0,0,1,1,1,1,0,1,1,1]
]

const lettreE = [
  [0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0],
  [0,0,1,1,1,1,1,0],
  [0,1,0,0,0,0,1,1],
  [1,1,1,1,1,1,1,1],
  [1,1,0,0,0,0,0,0],
  [1,1,0,0,0,0,0,0],
  [1,1,0,0,0,0,0,0],
  [1,1,1,0,0,0,0,1],
  [0,1,1,0,0,0,1,1],
  [0,0,1,1,1,1,1,0]
]

const lettreN = [
  [0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,1,1,0,0,1,1,1,0,0,0],
  [0,1,1,1,1,1,0,0,1,1,0,0],
  [0,0,1,1,0,0,0,0,1,1,0,0],
  [0,0,1,1,0,0,0,0,1,1,0,0],
  [0,0,1,1,0,0,0,0,1,1,0,0],
  [0,0,1,1,0,0,0,0,1,1,0,0],
  [0,0,1,1,0,0,0,0,1,1,0,0],
  [0,0,1,1,0,0,0,0,1,1,0,0],
  [1,1,1,1,1,1,1,1,1,1,1,1]
]
const lettreB = [
  [1,1,1,1,1,1,1,1,1,0,0,0,0],
  [0,1,1,1,0,0,0,0,1,1,1,0,0],
  [0,0,1,1,0,0,0,0,0,1,1,0,0],
  [0,0,1,1,0,0,0,0,0,1,1,0,0],
  [0,0,1,1,0,0,0,0,0,1,1,0,0],
  [0,0,1,1,0,0,0,0,0,1,0,0,0],
  [0,0,1,1,0,0,0,0,1,0,0,0,0],
  [0,0,1,1,1,1,1,1,1,1,1,0,0],
  [0,0,1,1,0,0,0,0,0,1,1,1,0],
  [0,0,1,1,0,0,0,0,0,0,0,1,1],
  [0,0,1,1,0,0,0,0,0,0,0,1,1],
  [0,0,1,1,0,0,0,0,0,0,0,1,1],
  [0,0,1,1,0,0,0,0,0,0,0,1,1],
  [0,1,1,1,1,0,0,0,0,1,1,1,0],
  [1,1,1,1,1,1,1,1,1,1,1,0,0]
];

const lettreI = [
  [0,0,1,1,0,0],
  [0,0,1,1,0,0],
  [0,0,0,0,0,0],
  [0,0,0,0,0,0],
  [0,0,0,0,0,0],
  [0,0,0,0,0,0],
  [0,0,1,1,0,0],
  [0,1,1,1,0,0],
  [0,0,1,1,0,0],
  [0,0,1,1,0,0],
  [0,0,1,1,0,0],
  [0,0,1,1,0,0],
  [0,0,1,1,0,0],
  [0,0,1,1,0,0],
  [1,1,1,1,1,1]
];

const lettreC = [
  [0,0,1,1,1,1,1,0],
  [0,1,1,0,0,0,1,1],
  [1,1,1,0,0,0,0,1],
  [1,1,0,0,0,0,0,0],
  [1,1,0,0,0,0,0,0],
  [1,1,0,0,0,0,0,0],
  [1,1,1,0,0,0,0,1],
  [0,1,1,0,0,0,1,1],
  [0,0,1,1,1,1,1,0]
];

const lettreH = [
  [1,1,1,0,0,1,1,1],
  [0,1,0,0,0,0,1,0],
  [0,1,0,0,0,0,1,0],
  [0,1,1,1,1,1,1,0],
  [0,1,1,1,1,1,1,0],
  [0,1,0,0,0,0,1,0],
  [0,1,0,0,0,0,1,0],
  [0,1,0,0,0,0,1,0],
  [1,1,1,0,0,1,1,1],
];

const lettreE2 = [
  [0,0,1,1,1,1,1,0],
  [0,1,0,0,0,0,1,1],
  [1,1,1,1,1,1,1,1],
  [1,1,0,0,0,0,0,0],
  [1,1,0,0,0,0,0,0],
  [1,1,0,0,0,0,0,0],
  [1,1,1,0,0,0,0,1],
  [0,1,1,0,0,0,1,1],
  [0,0,1,1,1,1,1,0]
];

const lettreZ = [
  [1,1,1,1,1,1,1,1],
  [1,0,0,0,0,0,1,1],
  [0,0,0,0,0,1,1,0],
  [0,0,0,0,1,1,0,0],
  [0,0,0,1,1,0,0,0],
  [0,0,1,1,0,0,0,0],
  [0,1,1,0,0,0,0,0],
  [1,1,0,0,0,0,0,1],
  [1,1,1,1,1,1,1,1],
];


const butterflyPattern2 = [
  [0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0],
  [0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 1, 0, 0, 0, 0, 0, 0],
  [0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 2, 1, 0, 0, 0, 0, 0],
  [0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 2, 2, 1, 0, 0, 0, 0],
  [0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 2, 2, 1, 0, 0, 0, 0],
  [0, 0, 0, 0, 0, 1, 2, 2, 2, 3, 2, 2, 2, 1, 0, 0, 0],
  [0, 0, 0, 0, 0, 1, 2, 2, 3, 3, 3, 2, 2, 1, 0, 0, 0],
  [0, 0, 0, 0, 0, 1, 2, 2, 2, 3, 2, 2, 2, 1, 0, 0, 0],
  [0, 0, 0, 0, 0, 1, 2, 2, 2, 2, 2, 2, 2, 2, 1, 0, 0],
  [0, 0, 0, 0, 0, 1, 2, 2, 2, 2, 2, 2, 1, 2, 1, 0, 0],
  [0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 2, 1, 2, 2, 1, 0, 0],
  [0, 0, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 1, 0, 0],
  [0, 1, 2, 2, 2, 2, 2, 1, 1, 1, 1, 2, 2, 2, 1, 0, 0],
  [1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 1, 2, 2, 1, 0, 0],
  [1, 2, 2, 2, 3, 2, 2, 2, 2, 2, 2, 3, 1, 2, 1, 0, 4],
  [1, 2, 2, 3, 3, 3, 2, 2, 2, 1, 2, 2, 3, 1, 4, 4, 0],
  [1, 2, 2, 2, 3, 2, 2, 2, 1, 2, 2, 2, 2, 4, 4, 4, 0],
  [1, 2, 2, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 4, 4, 0, 0],
  [0, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 4, 4, 0, 0, 0],
  [0, 0, 1, 2, 2, 2, 2, 2, 2, 1, 1, 4, 4, 0, 0, 0, 0],
  [0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 4, 0, 0, 0, 0, 0],
  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 0, 0, 0, 0, 0, 0],
];

const fleur1 = [
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,3,3,0,0,0,0,3,3,3,3,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,1,2,0,0,3,1,1,3,0,0,3,1,1,1,1,3,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,2,0,0,3,1,1,1,3,0,3,1,1,4,4,1,1,3,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,0,3,1,1,4,4,4,3,4,4,4,4,4,1,1,3,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,3,1,1,4,4,4,3,4,4,4,4,4,1,1,3,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,3,1,4,4,4,3,5,4,4,4,4,1,3,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,1,3,3,4,4,3,5,5,4,4,3,3,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,1,1,1,1,4,5,3,6,7,7,7,3,3,1,1,3,3,3,3,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,1,1,4,4,4,4,6,7,6,2,6,6,4,4,1,1,1,1,1,3],
  [0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,3,1,4,4,4,4,4,6,7,2,2,6,7,5,4,4,4,1,1,1,3],
  [0,0,0,0,0,3,3,1,1,3,0,0,0,3,3,3,1,1,1,1,4,4,6,7,7,7,6,5,4,4,4,4,1,1,1,3],
  [0,0,0,0,3,1,1,1,1,1,3,0,3,1,1,1,3,1,1,1,1,3,3,5,4,4,3,5,4,4,4,4,4,1,1,3],
  [0,0,0,3,1,1,1,4,4,1,1,3,3,1,1,1,1,3,1,3,3,4,5,4,4,4,4,3,3,3,4,4,1,1,1,3],
  [0,0,0,3,1,1,4,4,4,4,4,4,3,1,4,4,1,1,3,2,0,3,4,4,4,4,4,4,3,0,3,3,3,3,3,0],
  [0,0,0,0,3,1,4,4,4,4,4,4,3,4,4,4,1,1,3,2,0,3,1,4,4,4,4,1,3,0,0,0,0,0,0,0],
  [0,0,0,0,3,1,4,4,4,4,4,3,4,4,4,4,1,1,3,2,0,3,1,1,1,1,1,1,3,0,0,0,0,0,0,0],
  [0,0,3,3,3,3,4,4,4,6,6,6,4,4,4,1,1,1,3,2,0,2,3,1,1,3,3,3,0,0,0,0,0,0,0,0],
  [0,3,1,1,1,4,3,3,6,7,6,7,6,5,5,3,3,3,0,2,0,2,0,3,3,0,0,0,0,0,0,0,0,0,0,0],
  [3,1,1,1,4,4,4,6,7,2,2,6,7,3,3,3,0,0,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [3,1,1,4,4,4,4,5,6,6,6,7,4,4,4,4,3,3,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [3,1,1,4,4,4,4,4,6,7,7,5,3,4,4,4,4,1,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,3,1,1,4,4,4,3,5,4,4,4,5,3,4,1,1,1,1,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,3,3,3,3,3,4,4,4,4,4,4,4,3,1,1,1,1,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,3,4,4,4,4,4,4,4,3,1,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,3,1,4,4,4,4,4,3,0,3,1,1,1,3,0,0,0,3,3,3,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,3,1,1,4,4,4,1,3,0,3,1,1,1,1,3,0,3,1,1,1,3,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,3,1,1,4,4,1,1,3,0,3,1,1,1,4,4,3,1,1,1,1,1,3,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,3,1,1,1,1,3,0,0,3,4,4,4,5,4,3,4,4,4,1,1,1,3,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,3,3,1,3,3,3,3,4,4,4,4,6,6,5,4,4,4,4,1,1,3,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,3,1,1,1,1,3,3,5,4,6,7,6,4,4,4,4,4,3,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,3,1,1,1,4,4,4,6,7,2,2,7,3,3,3,3,3,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,3,1,1,4,4,4,4,5,7,2,6,6,5,4,4,3,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,3,1,1,4,4,3,3,6,6,5,4,4,4,4,4,3,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,4,3,4,4,4,4,4,3,4,4,4,4,1,3,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,1,4,4,4,4,4,3,4,4,4,1,1,3,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,3,1,1,4,4,1,3,0,3,1,1,1,1,3,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,3,1,1,1,1,3,0,3,1,1,1,3,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,0,3,1,1,1,3,0,0,3,3,3,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
];


const fleur2 = [
  [0,0,0,0,0,0,0,3,2,1,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,2,1,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,1,2,3,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,2,3,4,2,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,3,2,3,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,2,3,4,3,1,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,2,2,1,1,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,4,4,2,3,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,3,3,4,3,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,2,5,2,1,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,3,2,2,2,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,2,3,4,2,1,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,2,4,1,2,0,0,0,0,0,0,0,3,0],
  [0,0,0,0,0,2,4,4,2,6,0,0,0,0,0,0,3,1,1],
  [0,0,0,0,0,2,1,2,4,6,0,0,0,0,0,0,2,2,1],
  [0,0,0,0,0,0,4,4,4,0,0,0,0,5,0,0,3,2,0],
  [0,0,0,0,0,2,6,4,0,0,0,0,5,0,0,0,1,4,3],
  [0,0,0,0,0,0,0,6,6,0,0,0,5,0,0,1,3,2,0],
  [0,0,0,6,0,0,0,6,6,0,0,5,6,0,0,3,2,1,3],
  [0,0,0,0,6,0,0,6,6,0,0,6,0,0,0,2,4,3,0],
  [0,3,0,0,6,0,0,6,5,0,0,6,0,0,1,3,2,3,0],
  [1,1,3,0,6,0,0,6,5,0,0,6,0,0,3,4,2,1,0],
  [1,2,2,0,5,6,0,6,5,0,6,6,0,0,4,2,5,3,0],
  [0,2,3,0,5,6,0,0,5,0,6,0,0,1,4,3,2,0,0],
  [3,4,1,0,5,5,0,0,6,0,6,0,0,5,2,4,2,3,0],
  [0,2,3,1,0,5,0,0,6,0,6,0,3,2,4,2,3,0,0],
  [3,1,2,3,0,0,5,0,6,0,6,0,3,6,4,4,1,0,0],
  [0,3,4,2,0,0,5,0,5,0,6,0,0,6,6,3,0,0,0],
  [0,3,2,3,1,0,0,5,5,6,6,0,0,6,0,0,0,0,0],
  [0,1,2,4,3,0,0,5,6,6,0,0,6,6,0,0,0,0,0],
  [0,3,5,3,4,0,0,0,6,6,0,0,6,0,0,0,0,0,0],
  [0,0,2,3,4,1,0,0,6,6,0,0,6,0,0,5,0,0,0],
  [0,3,2,4,2,5,0,0,5,6,0,6,5,0,5,0,0,0,0],
  [0,0,3,2,4,2,3,0,0,6,0,6,5,5,5,0,0,0,0],
  [0,0,1,4,4,6,0,0,0,6,0,5,5,5,0,0,0,0,0],
  [0,0,0,3,6,6,0,0,0,6,0,5,5,0,0,0,0,0,0],
  [0,0,0,0,0,6,0,0,0,6,0,5,5,0,0,0,0,0,0],
  [0,0,0,0,0,5,5,0,0,5,0,5,5,0,0,0,0,0,0],
  [0,0,0,0,0,0,5,0,0,5,0,5,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,5,0,6,5,0,5,0,0,0,0,0,0,0],
  [0,0,0,0,5,0,5,6,0,5,0,5,0,0,0,0,0,0,0],
  [0,0,0,0,0,5,5,6,0,5,0,5,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,5,0,0,5,0,5,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,5,0,0,5,0,5,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,5,0,0,5,0,5,0,0,0,0,0,0,0]
]

const fleur3 = [
  [0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0],
  [0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0],
  [0,0,0,0,0,2,2,2,2,2,1,1,0,3,3,0],
  [0,0,0,3,4,4,1,1,1,1,2,1,2,1,3,3],
  [0,0,3,2,1,3,2,2,1,4,2,1,2,1,3,3],
  [0,3,3,2,3,2,2,2,4,3,3,4,2,1,3,3],
  [0,3,2,1,3,2,2,4,4,3,3,2,2,1,3,3],
  [0,3,4,1,3,4,4,3,3,3,1,2,4,1,3,0],
  [0,0,3,4,4,3,3,3,4,1,1,2,4,3,4,0],
  [3,2,3,3,3,3,4,4,3,3,3,2,3,3,4,0],
  [3,3,2,2,2,2,2,3,3,3,2,1,3,4,4,0],
  [0,3,3,3,1,4,2,2,2,2,4,3,4,4,0,0],
  [0,0,0,0,3,1,4,4,4,4,4,4,4,0,0,0],
  [0,0,0,3,3,3,1,1,1,3,5,0,0,0,0,0],
  [0,0,0,3,3,3,3,3,3,3,5,0,0,0,0,0],
  [0,0,0,0,3,3,3,3,3,0,5,5,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,5,5,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,5,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,5,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,5,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,5,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,5,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,5,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,5,0,0,0,0],
];

const fleurMolti = [
  [0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,1,2,2,1,1,0,2,2,2,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,1,1,2,2,2,2,1,1,3,3,2,2,2,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,1,2,2,3,3,3,2,2,1,3,3,3,3,2,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,2,3,3,1,1,3,3,2,1,3,3,3,3,3,3,2,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,2,3,3,2,2,2,1,3,2,2,1,3,3,3,3,3,3,1,0,4,0,0,4,4,4,4,0,4,4,4,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,3,1,1,1,3,3,1,3,3,2,1,3,3,3,3,3,2,1,4,4,0,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,3,1,1,2,3,3,1,3,2,3,3,2,1,3,3,2,2,1,1,4,4,4,4,4,5,5,5,4,6,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,2,3,1,2,3,3,3,1,3,2,2,3,3,1,3,2,2,1,1,4,4,4,4,5,5,4,4,4,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,2,3,1,2,2,3,3,1,3,2,2,2,3,3,1,1,1,1,0,2,2,2,5,5,4,4,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,1,2,3,3,1,3,3,1,3,3,2,2,3,3,2,2,3,3,0,2,2,1,1,2,4,5,5,4,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],
  [1,2,3,3,3,3,3,3,2,3,3,3,3,3,2,1,1,2,3,3,3,2,2,1,1,2,4,4,4,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0],
  [1,2,3,3,3,3,3,3,3,2,3,2,2,2,1,1,3,3,2,3,3,3,2,1,1,2,4,4,0,4,4,0,0,0,4,0,4,4,0,0,0,0,0,0,0],
  [1,2,2,3,3,3,3,1,1,1,1,1,1,1,3,3,3,3,3,3,3,3,2,1,1,2,4,4,4,4,0,0,0,4,4,4,4,4,0,0,0,0,0,0,0],
  [0,1,2,2,3,1,1,2,2,2,3,3,3,3,3,3,2,2,3,3,3,3,2,1,1,4,4,6,6,0,0,4,0,4,4,5,4,4,0,0,0,0,0,0,0],
  [0,0,0,1,1,2,2,3,3,3,3,3,3,3,2,2,2,3,3,3,3,3,2,2,1,4,6,6,0,0,4,4,4,4,5,4,4,4,0,0,0,0,0,0,0],
  [0,0,1,2,2,3,3,3,3,3,3,2,2,2,2,2,3,3,3,3,3,3,3,2,1,4,4,0,0,0,4,4,4,5,4,4,4,0,0,0,0,0,0,0,0],
  [0,0,0,3,3,3,3,0,0,3,3,3,2,2,2,3,3,3,3,3,3,3,3,2,1,1,0,0,0,4,4,4,5,4,4,5,4,0,4,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,1,1,0,6,0,4,4,5,4,5,5,4,4,4,6,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,1,1,1,0,6,0,4,4,5,4,4,4,4,6,6,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,2,2,3,3,3,3,3,3,3,2,0,3,3,3,3,2,2,1,1,0,6,6,4,4,5,4,4,4,6,6,6,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,2,2,2,3,3,3,3,2,2,2,0,2,2,2,2,2,1,1,1,0,6,6,4,4,5,4,4,4,4,4,0,4,4,4,0,0,0,0,0],
  [0,0,0,0,0,1,2,2,2,2,2,2,2,1,1,2,0,0,2,2,1,1,1,1,0,0,6,4,4,5,4,4,4,5,5,4,4,4,6,0,0,0,0,0,0],
  [0,0,0,0,0,1,1,2,2,2,2,1,1,1,2,0,0,0,1,1,1,4,0,4,0,0,6,4,4,5,5,5,5,4,4,4,6,6,0,0,0,0,0,0,0],
  [0,0,0,0,0,1,1,1,1,1,1,1,2,2,0,0,0,0,0,0,0,0,4,0,4,0,4,4,4,5,4,4,4,6,6,6,6,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,1,1,1,2,2,0,0,0,1,1,1,1,1,0,0,4,0,4,0,4,4,5,5,4,6,6,6,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,2,2,1,1,1,2,0,4,0,2,2,2,2,2,2,4,4,4,4,4,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,1,1,2,4,3,2,1,1,1,1,2,2,4,4,4,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,3,3,2,2,2,1,2,3,3,3,2,2,2,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,3,3,3,3,3,2,2,1,2,3,3,3,2,2,2,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,1,1,2,2,2,1,3,3,3,3,3,3,2,1,1,3,3,3,2,2,2,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,1,1,2,2,2,2,2,1,3,3,3,3,3,2,2,1,1,3,3,3,2,2,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,1,2,2,3,3,3,3,3,2,3,3,3,3,3,2,2,1,3,3,3,2,2,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,1,2,3,3,3,3,3,2,3,3,3,3,3,3,3,2,1,1,3,3,2,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,3,3,3,3,3,1,3,3,3,3,2,2,2,3,3,2,1,3,3,2,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,2,3,1,1,1,3,3,1,2,3,3,2,1,1,2,2,3,3,1,3,2,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,2,3,1,1,2,2,1,3,1,1,2,3,3,2,1,1,2,2,3,1,3,2,1,1,0,4,4,0,4,4,4,4,0,0,0,0,0,0,0],
  [0,0,0,0,0,2,3,1,1,2,2,3,3,1,3,1,2,2,3,2,1,1,1,2,2,3,2,1,1,0,4,4,0,4,4,4,4,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,2,3,1,2,2,3,3,3,3,2,1,1,2,3,3,2,1,1,2,2,3,3,2,0,4,4,4,4,5,4,4,0,0,6,6,4,4,0,0,0],
  [0,0,0,0,0,2,3,1,1,2,3,3,3,2,1,3,1,1,2,3,3,2,1,2,2,3,3,1,2,4,4,4,5,4,4,6,6,6,6,4,4,0,0,0,0],
  [0,0,0,0,0,1,2,3,1,2,3,3,3,2,1,3,3,1,1,3,3,2,1,2,3,3,3,1,2,4,4,5,4,4,6,4,4,4,4,4,4,4,4,4,4],
  [0,0,0,0,0,0,1,2,3,1,2,3,3,2,1,3,3,3,1,3,3,2,2,2,3,3,3,1,2,1,4,5,4,4,4,5,5,5,5,5,4,4,4,4,0],
  [0,0,0,0,0,0,1,2,3,1,2,3,2,1,3,3,3,3,1,1,3,3,2,3,3,3,2,1,2,1,5,5,5,5,5,4,4,4,4,4,4,4,4,0,0],
  [0,0,0,0,0,0,1,2,3,1,1,2,1,3,3,3,3,3,3,1,3,3,3,3,3,3,2,1,2,1,4,4,4,5,4,6,6,6,6,6,6,0,0,0,0],
  [0,0,0,0,0,0,0,1,2,3,1,1,3,3,3,3,3,3,2,1,2,3,3,3,3,2,1,3,2,1,4,6,4,5,4,4,6,6,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,1,2,3,3,2,3,3,2,2,2,2,1,3,1,2,3,3,3,2,1,3,2,1,0,6,6,4,5,4,4,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,1,2,2,3,1,2,2,2,2,1,1,3,3,3,1,3,3,3,1,3,3,2,2,1,0,6,6,4,4,4,4,4,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,1,1,2,2,3,1,1,1,1,1,3,3,3,3,1,3,3,3,3,3,3,2,2,1,0,0,0,6,6,4,4,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,1,1,2,2,2,0,2,3,3,3,3,3,3,1,3,3,3,3,3,2,2,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,1,1,0,0,2,3,3,3,3,3,3,1,0,3,2,2,2,2,1,1,1,4,4,4,4,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,3,3,3,3,1,0,4,0,1,1,1,1,1,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,1,1,1,2,2,0,0,0,2,2,3,3,3,1,1,4,0,4,0,1,1,4,4,4,6,6,6,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,1,1,1,1,1,1,1,2,2,0,0,1,2,2,2,1,0,4,0,4,0,4,4,4,5,4,4,4,6,6,6,6,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,1,1,2,2,2,2,1,1,1,2,0,0,1,1,1,0,4,0,4,0,0,6,4,4,5,5,5,5,4,4,4,6,6,0,0,0,0,0,0,0],
  [0,0,0,0,0,1,2,2,2,2,2,2,2,1,1,2,0,0,2,2,1,1,1,1,0,0,6,4,4,5,4,4,4,5,5,4,4,4,6,0,0,0,0,0,0],
  [0,0,0,0,0,0,2,2,2,3,3,3,3,2,2,2,0,2,2,2,2,2,1,1,1,0,6,6,4,4,5,4,4,4,4,4,0,4,4,4,0,0,0,0,0],
  [0,0,0,0,0,0,2,2,3,3,3,3,3,3,3,2,0,3,3,3,3,2,2,1,1,0,6,6,4,4,5,4,4,4,6,6,6,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,1,1,1,0,6,0,4,4,5,4,4,4,4,6,6,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,1,1,0,6,0,4,4,5,4,5,5,4,4,4,6,0,0,0,0,0,0],
  [0,0,0,3,3,3,3,0,0,3,3,3,2,2,2,3,3,3,3,3,3,3,3,2,1,1,0,0,0,4,4,4,5,4,4,5,4,0,4,0,0,0,0,0,0],
  [0,0,1,2,2,3,3,3,3,3,3,2,2,2,2,2,3,3,3,3,3,3,3,2,1,4,4,0,0,0,4,4,4,5,4,4,4,0,0,0,0,0,0,0,0],
  [0,0,0,1,1,2,2,3,3,3,3,3,3,3,2,2,2,3,3,3,3,3,2,2,1,4,6,6,0,0,4,4,4,4,5,4,4,4,0,0,0,0,0,0,0],
  [0,1,2,2,3,1,1,2,2,2,3,3,3,3,3,3,2,2,3,3,3,3,2,1,1,4,4,6,6,0,0,4,0,4,4,5,4,4,0,0,0,0,0,0,0],
  [1,2,2,3,3,3,3,1,1,1,1,1,1,1,3,3,3,3,3,3,3,3,2,1,1,2,4,4,4,4,0,0,0,4,4,4,4,4,0,0,0,0,0,0,0],
  [1,2,3,3,3,3,3,3,3,2,3,2,2,2,1,1,3,3,2,3,3,3,2,1,1,2,4,4,0,4,4,0,0,0,4,0,4,4,0,0,0,0,0,0,0],
  [1,2,3,3,3,3,3,3,2,3,3,3,3,3,2,1,1,2,3,3,3,2,2,1,1,2,4,4,4,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0],
  [0,1,2,3,3,1,3,3,1,3,3,2,2,3,3,2,2,3,3,0,2,2,1,1,2,4,5,5,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,2,3,1,2,2,3,3,1,3,2,2,2,3,3,1,1,1,1,0,2,2,2,5,5,4,4,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,2,3,1,2,3,3,3,1,3,2,2,3,3,1,3,2,2,1,1,4,4,4,4,5,5,4,4,4,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,3,1,1,2,3,3,1,3,2,3,3,2,1,3,3,2,2,1,1,4,4,4,4,4,5,5,5,4,6,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,3,1,1,1,3,3,1,3,3,2,1,3,3,3,3,3,2,1,4,4,0,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,2,3,3,2,2,2,1,3,2,1,1,3,3,3,3,3,3,1,0,4,0,0,4,4,4,4,0,4,4,4,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,2,3,3,1,1,3,3,2,1,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,1,2,2,3,3,3,2,2,1,3,3,3,3,2,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,1,1,2,2,2,2,1,1,3,3,2,2,2,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,1,2,2,1,1,0,2,2,2,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
]

const flippedPattern = fleurMolti.map(row => [...row].reverse());

// --- CREA PATTERN PROPORZIONALI ---
// ---------------- CREATE PATTERNS ----------------
function patternWidth(pattern, size) {
  return pattern[0].length * size;
}

function patternSize(pattern, size) {
  return {
    width: pattern[0].length * size,
    height: pattern.length * size
  };
}

function createPatterns() {
  patterns = [];

  const chez = [lettreC, lettreH, lettreE2, lettreZ];
  const scale = canva.width / 1200;
  const size = Math.max(minSize, 6 * scale);
  const spacing = size * 1.0;
  const bottomMargin = size * 3.5;

  const word = [
    lettreB, lettreI, lettreE, lettreN,
    lettreV, lettreE, lettreN, lettreU, lettreE
  ];

  const bienvenueHeight =
  Math.max(...word.map(p => patternSize(p, size).height));

  

  const totalWidth =
    word.reduce((sum, p) => sum + patternWidth(p, size), 0) +
    spacing * (word.length - 1);

  let x = (canva.width - totalWidth) / 2;
  const y = size * 2.5;
  const chezSpacing = size * 5.5; // distanza verticale
const chezY = y + bienvenueHeight + chezSpacing;

  word.forEach(pattern => {
    patterns.push(
      new PatternStitches(pattern, palettes[0], x, y, size)
    );
    x += patternWidth(pattern, size) + spacing;
  });

  const chezWidth =
  chez.reduce((sum, p) => sum + patternWidth(p, size), 0) +
  spacing * (chez.length - 1);

let cx = (canva.width - chezWidth) / 2;

chez.forEach(pattern => {
  patterns.push(
    new PatternStitches(pattern, palettes[0], cx, chezY, size)
  );
  cx += patternWidth(pattern, size) + spacing;
});

  const margin = size;

// fleur gauche
const f1 = patternSize(flippedPattern, size);
patterns.push(
  new PatternStitches(
    flippedPattern,
    palettes[4],
    margin,
    canva.height - f1.height - bottomMargin,
    size
  )
);

// fleur droite
const f2 = patternSize(fleurMolti, size);
patterns.push(
  new PatternStitches(
    fleurMolti,
    palettes[4],
    canva.width - f2.width - margin,
    canva.height - f2.height - bottomMargin,
    size
  )
);

// fleur bas droite (decorativa)
// const f3 = patternSize(fleur2, size);
// patterns.push(
//   new PatternStitches(
//     fleur2,
//     palettes[2],
//     (canva.width - f3.width) / 2,
//     canva.height - f3.height - bottomMargin,
//     size/1.5
//   )
// );
}

const img = document.querySelector("img");
createPatterns();
setTimeout(() => {
  img.style.opacity = '1';
  img.style.transform = 'translate(-50%,-50%) scale(2.3)'
}, 3000);

// ---------------- ANIMATION ----------------
let needsRedraw = true;

function animate() {
  if (needsRedraw) {
    context.clearRect(0, 0, canva.width, canva.height);
    patterns.forEach(p => {
      p.update();
      p.draw();
    });
  }
  requestAnimationFrame(animate);
}

animate();
