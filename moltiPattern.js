const canva = document.querySelector("canvas");
const context = canva.getContext("2d");

function resizeCanvas() {
  canva.width = window.innerWidth;
  canva.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener('resize', () => {
  resizeCanvas();
  createPatterns();
});

let patterns = [];
const SPEED = 2;
const minSize = 3; // dimensione minima punti
const STITCHES_PER_FRAME = 3;


class Cucito {
  constructor(x, y, size, color) {
    this.x = x;
    this.y = y;
    this.size = size;
    this.color = color;
    this.state = 0;
    this.progress = 0;
  }

  drawSegment(x1, y1, x2, y2, p) {
    const midX = x1 + (x2 - x1) * p + Math.sin(p * Math.PI) * 1.2;
    const midY = y1 + (y2 - y1) * p + Math.cos(p * Math.PI) * 1.2;
    const width = 2.5 + Math.sin(p * Math.PI) * 1.2;

    // filo ombra
    context.strokeStyle = "rgba(0,0,0,0.25)";
    context.lineWidth = width + 2;
    context.beginPath();
    context.moveTo(x1 + 1.5, y1 + 1.5);
    context.lineTo(midX + 1.5, midY + 1.5);
    context.stroke();

    // filo principale
    context.strokeStyle = this.color;
    context.lineCap = "round";
    context.lineWidth = width;
    context.beginPath();
    context.moveTo(x1, y1);
    context.lineTo(midX, midY);
    context.stroke();

    return { x: midX, y: midY };
  }

  draw(offsetX = 0, offsetY = 0) {
    let needlePos = null;

    const x = this.x + offsetX;
    const y = this.y + offsetY;

    if (this.state === 1)
      needlePos = this.drawSegment(
        x,
        y,
        x + this.size,
        y + this.size,
        this.progress,
      );

    if (this.state >= 2)
      this.drawSegment(x, y, x + this.size, y + this.size, 1);

    if (this.state === 3)
      needlePos = this.drawSegment(
        x + this.size,
        y,
        x,
        y + this.size,
        this.progress,
      );

    if (this.state >= 4)
      this.drawSegment(x + this.size, y, x, y + this.size, 1);

    return needlePos;
  }

  update() {
    if (this.state === 1 || this.state === 3) {
      this.progress += SPEED;
      if (this.progress >= 1) {
        this.progress = 0;
        this.state++;
      }
    }
  }
}

class PatternStitches {
  constructor(pattern, palette, offsetX, offsetY, size) {
     this.stitches = [];
   this.colorGroups = {};
    this.colorStates = {};

    pattern.forEach((row, y) => {
      row.forEach((cell, x) => {
        if (cell !== 0) {
          const stitch = new Cucito(
            offsetX + x * size,
            offsetY + y * size,
            size,
            palette[cell]
          );

          if (!this.colorGroups[stitch.color]) {
            this.colorGroups[stitch.color] = [];
            this.colorStates[stitch.color] = 0;
          }

          this.colorGroups[stitch.color].push(stitch);
        }
      });
    });
  }

  draw() {
  for (const color in this.colorGroups) {
    this.colorGroups[color].forEach(s => s.draw());
  }
}

  update() {
  for (let i = 0; i < STITCHES_PER_FRAME; i++) {
    for (const color in this.colorGroups) {
      const group = this.colorGroups[color];
      let index = this.colorStates[color];
      const stitch = group[index];
      if (!stitch) continue;

      if (stitch.state === 0) stitch.state = 1;
      stitch.update();
      if (stitch.state === 2) stitch.state = 3;

      if (stitch.state === 4) {
        this.colorStates[color]++;
      }
    }
  }
}
}

const palettes = [
  { 1: "#000" },
  { 1: "#6888BF", 2: "#3B6F32", 3: "#404C8E", 4: "#A8C9F9", 5: "#FFF4C3", 6: "#95885F", 7: "#E9C500" },
  { 1: "#CE9ADE", 2: "#8470A9", 3: "#949CC8", 4: "#381F53", 5: "#3E7D4B", 6: "#1D401B" },
];

const lettreV = [
  [0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0],
  [1,1,1,1,1,0,0,1,1,1],
  [0,1,1,1,0,0,0,0,1,0],
  [0,0,1,1,0,0,0,1,0,0],
  [0,0,1,1,0,0,0,1,0,0],
  [0,0,0,1,1,0,1,0,0,0],
  [0,0,0,1,1,0,1,0,0,0],
  [0,0,0,0,1,1,0,0,0,0],
  [0,0,0,0,1,1,0,0,0,0],
  [0,0,0,0,0,1,0,0,0,0]
];

const lettreU = [
  [0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0],
  [1,1,1,1,0,0,1,1,1,1,0],
  [0,0,1,1,0,0,0,0,1,1,0],
  [0,0,1,1,0,0,0,0,1,1,0],
  [0,0,1,1,0,0,0,0,1,1,0],
  [0,0,1,1,0,0,0,0,1,1,0],
  [0,0,1,1,0,0,0,0,1,1,0],
  [0,0,1,1,0,0,0,0,1,1,0],
  [0,0,1,1,0,0,0,1,1,1,0],
  [0,0,0,1,1,1,1,0,1,1,1]
]

const lettreE = [
  [0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0],
  [0,0,1,1,1,1,1,0],
  [0,1,0,0,0,0,1,1],
  [1,1,1,1,1,1,1,1],
  [1,1,0,0,0,0,0,0],
  [1,1,0,0,0,0,0,0],
  [1,1,0,0,0,0,0,0],
  [1,1,1,0,0,0,0,1],
  [0,1,1,0,0,0,1,1],
  [0,0,1,1,1,1,1,0]
]

const lettreN = [
  [0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,1,1,0,0,1,1,1,0,0,0],
  [0,1,1,1,1,1,0,0,1,1,0,0],
  [0,0,1,1,0,0,0,0,1,1,0,0],
  [0,0,1,1,0,0,0,0,1,1,0,0],
  [0,0,1,1,0,0,0,0,1,1,0,0],
  [0,0,1,1,0,0,0,0,1,1,0,0],
  [0,0,1,1,0,0,0,0,1,1,0,0],
  [0,0,1,1,0,0,0,0,1,1,0,0],
  [1,1,1,1,1,1,1,1,1,1,1,1]
]
const lettreB = [
  [1,1,1,1,1,1,1,1,1,0,0,0,0],
  [0,1,1,1,0,0,0,0,1,1,1,0,0],
  [0,0,1,1,0,0,0,0,0,1,1,0,0],
  [0,0,1,1,0,0,0,0,0,1,1,0,0],
  [0,0,1,1,0,0,0,0,0,1,1,0,0],
  [0,0,1,1,0,0,0,0,0,1,0,0,0],
  [0,0,1,1,0,0,0,0,1,0,0,0,0],
  [0,0,1,1,1,1,1,1,1,1,1,0,0],
  [0,0,1,1,0,0,0,0,0,1,1,1,0],
  [0,0,1,1,0,0,0,0,0,0,0,1,1],
  [0,0,1,1,0,0,0,0,0,0,0,1,1],
  [0,0,1,1,0,0,0,0,0,0,0,1,1],
  [0,0,1,1,0,0,0,0,0,0,0,1,1],
  [0,1,1,1,1,0,0,0,0,1,1,1,0],
  [1,1,1,1,1,1,1,1,1,1,1,0,0]
];

const lettreI = [
  [0,0,1,1,0,0],
  [0,0,1,1,0,0],
  [0,0,0,0,0,0],
  [0,0,0,0,0,0],
  [0,0,0,0,0,0],
  [0,0,0,0,0,0],
  [0,0,1,1,0,0],
  [0,1,1,1,0,0],
  [0,0,1,1,0,0],
  [0,0,1,1,0,0],
  [0,0,1,1,0,0],
  [0,0,1,1,0,0],
  [0,0,1,1,0,0],
  [0,0,1,1,0,0],
  [1,1,1,1,1,1]
];


const butterflyPattern2 = [
  [0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0],
  [0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 1, 0, 0, 0, 0, 0, 0],
  [0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 2, 1, 0, 0, 0, 0, 0],
  [0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 2, 2, 1, 0, 0, 0, 0],
  [0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 2, 2, 1, 0, 0, 0, 0],
  [0, 0, 0, 0, 0, 1, 2, 2, 2, 3, 2, 2, 2, 1, 0, 0, 0],
  [0, 0, 0, 0, 0, 1, 2, 2, 3, 3, 3, 2, 2, 1, 0, 0, 0],
  [0, 0, 0, 0, 0, 1, 2, 2, 2, 3, 2, 2, 2, 1, 0, 0, 0],
  [0, 0, 0, 0, 0, 1, 2, 2, 2, 2, 2, 2, 2, 2, 1, 0, 0],
  [0, 0, 0, 0, 0, 1, 2, 2, 2, 2, 2, 2, 1, 2, 1, 0, 0],
  [0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 2, 1, 2, 2, 1, 0, 0],
  [0, 0, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 1, 0, 0],
  [0, 1, 2, 2, 2, 2, 2, 1, 1, 1, 1, 2, 2, 2, 1, 0, 0],
  [1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 1, 2, 2, 1, 0, 0],
  [1, 2, 2, 2, 3, 2, 2, 2, 2, 2, 2, 3, 1, 2, 1, 0, 4],
  [1, 2, 2, 3, 3, 3, 2, 2, 2, 1, 2, 2, 3, 1, 4, 4, 0],
  [1, 2, 2, 2, 3, 2, 2, 2, 1, 2, 2, 2, 2, 4, 4, 4, 0],
  [1, 2, 2, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 4, 4, 0, 0],
  [0, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 4, 4, 0, 0, 0],
  [0, 0, 1, 2, 2, 2, 2, 2, 2, 1, 1, 4, 4, 0, 0, 0, 0],
  [0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 4, 0, 0, 0, 0, 0],
  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 0, 0, 0, 0, 0, 0],
];

const butterflyPattern3 = [
  [0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0],
  [0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 1, 0, 0, 0, 0, 0, 0],
  [0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 2, 1, 0, 0, 0, 0, 0],
  [0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 2, 2, 1, 0, 0, 0, 0],
  [0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 2, 2, 1, 0, 0, 0, 0],
  [0, 0, 0, 0, 0, 1, 2, 2, 2, 3, 2, 2, 2, 1, 0, 0, 0],
  [0, 0, 0, 0, 0, 1, 2, 2, 3, 3, 3, 2, 2, 1, 0, 0, 0],
  [0, 0, 0, 0, 0, 1, 2, 2, 2, 3, 2, 2, 2, 1, 0, 0, 0],
  [0, 0, 0, 0, 0, 1, 2, 2, 2, 2, 2, 2, 2, 2, 1, 0, 0],
  [0, 0, 0, 0, 0, 1, 2, 2, 2, 2, 2, 2, 1, 2, 1, 0, 0],
  [0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 2, 1, 2, 2, 1, 0, 0],
  [0, 0, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 1, 0, 0],
  [0, 1, 2, 2, 2, 2, 2, 1, 1, 1, 1, 2, 2, 2, 1, 0, 0],
  [1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 1, 2, 2, 1, 0, 0],
  [1, 2, 2, 2, 3, 2, 2, 2, 2, 2, 2, 3, 1, 2, 1, 0, 4],
  [1, 2, 2, 3, 3, 3, 2, 2, 2, 1, 2, 2, 3, 1, 4, 4, 0],
  [1, 2, 2, 2, 3, 2, 2, 2, 1, 2, 2, 2, 2, 4, 4, 4, 0],
  [1, 2, 2, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 4, 4, 0, 0],
  [0, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 4, 4, 0, 0, 0],
  [0, 0, 1, 2, 2, 2, 2, 2, 2, 1, 1, 4, 4, 0, 0, 0, 0],
  [0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 4, 0, 0, 0, 0, 0],
  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 0, 0, 0, 0, 0, 0],
];

const fleur1 = [
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,3,3,0,0,0,0,3,3,3,3,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,1,2,0,0,3,1,1,3,0,0,3,1,1,1,1,3,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,2,0,0,3,1,1,1,3,0,3,1,1,4,4,1,1,3,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,0,3,1,1,4,4,4,3,4,4,4,4,4,1,1,3,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,3,1,1,4,4,4,3,4,4,4,4,4,1,1,3,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,3,1,4,4,4,3,5,4,4,4,4,1,3,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,1,3,3,4,4,3,5,5,4,4,3,3,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,1,1,1,1,4,5,3,6,7,7,7,3,3,1,1,3,3,3,3,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,1,1,4,4,4,4,6,7,6,2,6,6,4,4,1,1,1,1,1,3],
  [0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,3,1,4,4,4,4,4,6,7,2,2,6,7,5,4,4,4,1,1,1,3],
  [0,0,0,0,0,3,3,1,1,3,0,0,0,3,3,3,1,1,1,1,4,4,6,7,7,7,6,5,4,4,4,4,1,1,1,3],
  [0,0,0,0,3,1,1,1,1,1,3,0,3,1,1,1,3,1,1,1,1,3,3,5,4,4,3,5,4,4,4,4,4,1,1,3],
  [0,0,0,3,1,1,1,4,4,1,1,3,3,1,1,1,1,3,1,3,3,4,5,4,4,4,4,3,3,3,4,4,1,1,1,3],
  [0,0,0,3,1,1,4,4,4,4,4,4,3,1,4,4,1,1,3,2,0,3,4,4,4,4,4,4,3,0,3,3,3,3,3,0],
  [0,0,0,0,3,1,4,4,4,4,4,4,3,4,4,4,1,1,3,2,0,3,1,4,4,4,4,1,3,0,0,0,0,0,0,0],
  [0,0,0,0,3,1,4,4,4,4,4,3,4,4,4,4,1,1,3,2,0,3,1,1,1,1,1,1,3,0,0,0,0,0,0,0],
  [0,0,3,3,3,3,4,4,4,6,6,6,4,4,4,1,1,1,3,2,0,2,3,1,1,3,3,3,0,0,0,0,0,0,0,0],
  [0,3,1,1,1,4,3,3,6,7,6,7,6,5,5,3,3,3,0,2,0,2,0,3,3,0,0,0,0,0,0,0,0,0,0,0],
  [3,1,1,1,4,4,4,6,7,2,2,6,7,3,3,3,0,0,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [3,1,1,4,4,4,4,5,6,6,6,7,4,4,4,4,3,3,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [3,1,1,4,4,4,4,4,6,7,7,5,3,4,4,4,4,1,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,3,1,1,4,4,4,3,5,4,4,4,5,3,4,1,1,1,1,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,3,3,3,3,3,4,4,4,4,4,4,4,3,1,1,1,1,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,3,4,4,4,4,4,4,4,3,1,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,3,1,4,4,4,4,4,3,0,3,1,1,1,3,0,0,0,3,3,3,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,3,1,1,4,4,4,1,3,0,3,1,1,1,1,3,0,3,1,1,1,3,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,3,1,1,4,4,1,1,3,0,3,1,1,1,4,4,3,1,1,1,1,1,3,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,3,1,1,1,1,3,0,0,3,4,4,4,5,4,3,4,4,4,1,1,1,3,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,3,3,1,3,3,3,3,4,4,4,4,6,6,5,4,4,4,4,1,1,3,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,3,1,1,1,1,3,3,5,4,6,7,6,4,4,4,4,4,3,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,3,1,1,1,4,4,4,6,7,2,2,7,3,3,3,3,3,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,3,1,1,4,4,4,4,5,7,2,6,6,5,4,4,3,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,3,1,1,4,4,3,3,6,6,5,4,4,4,4,4,3,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,4,3,4,4,4,4,4,3,4,4,4,4,1,3,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,1,4,4,4,4,4,3,4,4,4,1,1,3,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,3,1,1,4,4,1,3,0,3,1,1,1,1,3,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,3,1,1,1,1,3,0,3,1,1,1,3,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,0,3,1,1,1,3,0,0,3,3,3,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
];


// { 1: "#CE9ADE", 2: "#8470A9", 3: "#949CC8", 4: "#381F53", 5: "#3E7D4B", 6: "#1D401B" },
const fleur2 = [
  [0,0,0,0,0,0,0,3,2,1,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,2,1,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,1,2,3,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,2,3,4,2,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,3,2,3,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,2,3,4,3,1,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,2,2,1,1,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,4,4,2,3,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,3,3,4,3,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,2,5,2,1,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,3,2,2,2,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,2,3,4,2,1,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,2,4,1,2,0,0,0,0,0,0,0,3,0],
  [0,0,0,0,0,2,4,4,2,6,0,0,0,0,0,0,3,1,1],
  [0,0,0,0,0,2,1,2,4,6,0,0,0,0,0,0,2,2,1],
  [0,0,0,0,0,0,4,4,4,0,0,0,0,5,0,0,3,2,0],
  [0,0,0,0,0,2,6,4,0,0,0,0,5,0,0,0,1,4,3],
  [0,0,0,0,0,0,0,6,6,0,0,0,5,0,0,1,3,2,0],
  [0,0,0,6,0,0,0,6,6,0,0,5,6,0,0,3,2,1,3],
  [0,0,0,0,6,0,0,6,6,0,0,6,0,0,0,2,4,3,0],
  [0,3,0,0,6,0,0,6,5,0,0,6,0,0,1,3,2,3,0],
  [1,1,3,0,6,0,0,6,5,0,0,6,0,0,3,4,2,1,0],
  [1,2,2,0,5,6,0,6,5,0,6,6,0,0,4,2,5,3,0],
  [0,2,3,0,5,6,0,0,5,0,6,0,0,1,4,3,2,0,0],
  [3,4,1,0,5,5,0,0,6,0,6,0,0,5,2,4,2,3,0],
  [0,2,3,1,0,5,0,0,6,0,6,0,3,2,4,2,3,0,0],
  [3,1,2,3,0,0,5,0,6,0,6,0,3,6,4,4,1,0,0],
  [0,3,4,2,0,0,5,0,5,0,6,0,0,6,6,3,0,0,0],
  [0,3,2,3,1,0,0,5,5,6,6,0,0,6,0,0,0,0,0],
  [0,1,2,4,3,0,0,5,6,6,0,0,6,6,0,0,0,0,0],
  [0,3,5,3,4,0,0,0,6,6,0,0,6,0,0,0,0,0,0],
  [0,0,2,3,4,1,0,0,6,6,0,0,6,0,0,5,0,0,0],
  [0,3,2,4,2,5,0,0,5,6,0,6,5,0,5,0,0,0,0],
  [0,0,3,2,4,2,3,0,0,6,0,6,5,5,5,0,0,0,0],
  [0,0,1,4,4,6,0,0,0,6,0,5,5,5,0,0,0,0,0],
  [0,0,0,3,6,6,0,0,0,6,0,5,5,0,0,0,0,0,0],
  [0,0,0,0,0,6,0,0,0,6,0,5,5,0,0,0,0,0,0],
  [0,0,0,0,0,5,5,0,0,5,0,5,5,0,0,0,0,0,0],
  [0,0,0,0,0,0,5,0,0,5,0,5,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,5,0,6,5,0,5,0,0,0,0,0,0,0],
  [0,0,0,0,5,0,5,6,0,5,0,5,0,0,0,0,0,0,0],
  [0,0,0,0,0,5,5,6,0,5,0,5,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,5,0,0,5,0,5,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,5,0,0,5,0,5,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,5,0,0,5,0,5,0,0,0,0,0,0,0]
]

// --- CREA PATTERN PROPORZIONALI ---
// ---------------- CREATE PATTERNS ----------------
function patternWidth(pattern, size) {
  return pattern[0].length * size;
}

function createPatterns() {
  patterns = [];

  const scale = canva.width / 1200;
  const size = Math.max(minSize, 6 * scale);
  const spacing = size * 1.5;

  const word = [
    lettreB, lettreI, lettreE, lettreN,
    lettreV, lettreE, lettreN, lettreU, lettreE
  ];

  const totalWidth =
    word.reduce((sum, p) => sum + patternWidth(p, size), 0) +
    spacing * (word.length - 1);

  let x = (canva.width - totalWidth) / 2;
  const y = canva.height / 1.5;

  word.forEach(pattern => {
    patterns.push(
      new PatternStitches(pattern, palettes[0], x, y, size)
    );
    x += patternWidth(pattern, size) + spacing;
  });

  patterns.push(
    new PatternStitches(fleur1,palettes[1],canva.width / 2,100,size)
  );
  patterns.push(
    new PatternStitches(fleur2,palettes[2],100,100,size)
  );
}

createPatterns();

// ---------------- ANIMATION ----------------
function animate() {
  context.clearRect(0, 0, canva.width, canva.height);
  patterns.forEach(p => {
    p.draw();
    p.update();
  });
  requestAnimationFrame(animate);
}

animate();
